<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8">

<title>module BlacklabHelper - WhiteLab 2.1.2</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="BackendHelper.html">BackendHelper</a>
  
  
  
    <li><a class="include" href="DataFormatHelper.html">DataFormatHelper</a>
  
  
  </ul>
</div>

    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-combine_patt_and_within">#combine_patt_and_within</a>
    
    <li ><a href="#method-i-db_type">#db_type</a>
    
    <li ><a href="#method-i-finish_query">#finish_query</a>
    
    <li ><a href="#method-i-gap_values_enabled">#gap_values_enabled</a>
    
    <li ><a href="#method-i-get_corpus_document_list">#get_corpus_document_list</a>
    
    <li ><a href="#method-i-get_counter_node">#get_counter_node</a>
    
    <li ><a href="#method-i-get_document_audio_file">#get_document_audio_file</a>
    
    <li ><a href="#method-i-get_document_content">#get_document_content</a>
    
    <li ><a href="#method-i-get_document_id_list">#get_document_id_list</a>
    
    <li ><a href="#method-i-get_document_list">#get_document_list</a>
    
    <li ><a href="#method-i-get_document_metadata">#get_document_metadata</a>
    
    <li ><a href="#method-i-get_document_sentence_count">#get_document_sentence_count</a>
    
    <li ><a href="#method-i-get_document_sentence_starts">#get_document_sentence_starts</a>
    
    <li ><a href="#method-i-get_document_snippet">#get_document_snippet</a>
    
    <li ><a href="#method-i-get_document_statistics">#get_document_statistics</a>
    
    <li ><a href="#method-i-get_document_xml_content">#get_document_xml_content</a>
    
    <li ><a href="#method-i-get_filtered_content">#get_filtered_content</a>
    
    <li ><a href="#method-i-get_filtered_document_list">#get_filtered_document_list</a>
    
    <li ><a href="#method-i-get_kwic">#get_kwic</a>
    
    <li ><a href="#method-i-get_metadata_from_server">#get_metadata_from_server</a>
    
    <li ><a href="#method-i-get_metadatum_values_by_label">#get_metadatum_values_by_label</a>
    
    <li ><a href="#method-i-get_pos_head_counts">#get_pos_head_counts</a>
    
    <li ><a href="#method-i-get_pos_heads_counted">#get_pos_heads_counted</a>
    
    <li ><a href="#method-i-get_pos_tag_by_label">#get_pos_tag_by_label</a>
    
    <li ><a href="#method-i-get_pos_tag_features_by_label">#get_pos_tag_features_by_label</a>
    
    <li ><a href="#method-i-get_pos_tag_types_by_label">#get_pos_tag_types_by_label</a>
    
    <li ><a href="#method-i-get_pos_tags">#get_pos_tags</a>
    
    <li ><a href="#method-i-name">#name</a>
    
    <li ><a href="#method-i-query_to_url">#query_to_url</a>
    
    <li ><a href="#method-i-reformat_content">#reformat_content</a>
    
    <li ><a href="#method-i-reformat_field_content">#reformat_field_content</a>
    
    <li ><a href="#method-i-reformat_filters">#reformat_filters</a>
    
    <li ><a href="#method-i-reformat_group">#reformat_group</a>
    
    <li ><a href="#method-i-reformat_output">#reformat_output</a>
    
    <li ><a href="#method-i-reformat_phonetic">#reformat_phonetic</a>
    
    <li ><a href="#method-i-reformat_pos_tag">#reformat_pos_tag</a>
    
    <li ><a href="#method-i-reformat_query_attributes">#reformat_query_attributes</a>
    
    <li ><a href="#method-i-reformat_sentence_content">#reformat_sentence_content</a>
    
    <li ><a href="#method-i-reformat_word_content">#reformat_word_content</a>
    
    <li ><a href="#method-i-run_benchmark_test">#run_benchmark_test</a>
    
    <li ><a href="#method-i-version">#version</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-BlacklabHelper">
  <h1 id="module-BlacklabHelper" class="module">
    module BlacklabHelper
  </h1>

  <section class="description">
    
<p>Backend helper specifically for BlackLab Server (<a
href="http://inl.github.io/BlackLab">inl.github.io/BlackLab</a>/).</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-combine_patt_and_within" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">combine_patt_and_within</span><span
            class="method-args">(query)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Combine the value of the within parameter with the query pattern</p>
          
          

          
          <div class="method-source-code" id="combine_patt_and_within-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 40</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">combine_patt_and_within</span>(<span class="ruby-identifier">query</span>)
  <span class="ruby-identifier">within</span> = <span class="ruby-identifier">query</span>.<span class="ruby-identifier">within</span>
  <span class="ruby-identifier">patt</span> = <span class="ruby-identifier">query</span>.<span class="ruby-identifier">patt</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">patt</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">within</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">within</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-string">&#39;document&#39;</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;#{patt} within (&lt;p/&gt; | &lt;event/&gt;)&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">within</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-string">&#39;paragraph&#39;</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;#{patt} within &lt;s/&gt;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">within</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-string">&#39;sentence&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-db_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">db_type</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return the backend identifier</p>
          
          

          
          <div class="method-source-code" id="db_type-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 130</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">db_type</span>
  <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;blacklab&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-finish_query" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">finish_query</span><span
            class="method-args">(query, response)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Finish query execution</p>
          
          

          
          <div class="method-source-code" id="finish_query-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 49</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">finish_query</span>(<span class="ruby-identifier">query</span>, <span class="ruby-identifier">response</span>)
  <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;FINISHING QUERY&quot;</span>
  <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-identifier">query</span>
  <span class="ruby-identifier">view</span> = <span class="ruby-identifier">query</span>.<span class="ruby-identifier">view</span>
  <span class="ruby-identifier">grouped</span> = [<span class="ruby-value">8</span>,<span class="ruby-value">16</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">view</span>)
  <span class="ruby-identifier">hits</span> = [<span class="ruby-value">1</span>,<span class="ruby-value">8</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">view</span>)
  <span class="ruby-identifier">key</span> = <span class="ruby-identifier">hits</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;hit&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;doc&quot;</span>
  <span class="ruby-identifier">key</span> = <span class="ruby-identifier">grouped</span> <span class="ruby-operator">?</span> <span class="ruby-node">&quot;#{key}Groups&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;#{key}s&quot;</span>
  <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;KEY: #{key}&quot;</span>
  <span class="ruby-identifier">status</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">key</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">response</span>[<span class="ruby-string">&#39;summary&#39;</span>][<span class="ruby-string">&#39;stillCounting&#39;</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">3</span> <span class="ruby-operator">:</span> <span class="ruby-value">4</span>
  <span class="ruby-identifier">output</span> = <span class="ruby-identifier">reformat_output</span>(<span class="ruby-identifier">response</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">query</span>)
  <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;QUERY STATUS = #{status}&quot;</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">output</span>, <span class="ruby-identifier">status</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gap_values_enabled" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gap_values_enabled</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>If gap values are enabled, the &#39;Import TSV&#39; buttons in Expert <a
href="Search.html">Search</a> and <a href="Explore.html">Explore</a>
N-grams are active. If gap values are disabled, the &#39;Import TSV&#39;
buttons show an alert explaining the functionality, but do not allow file
upload. The functionality will likely become available in BlackLab version
1.6.0.</p>
          
          

          
          <div class="method-source-code" id="gap_values_enabled-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 10</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gap_values_enabled</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">version</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;.&#39;</span>,<span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">150</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_corpus_document_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_corpus_document_list</span><span
            class="method-args">(corpus)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve the entire list of documents for a specific corpus</p>
          
          

          
          <div class="method-source-code" id="get_corpus_document_list-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 214</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_corpus_document_list</span>(<span class="ruby-identifier">corpus</span>)
  <span class="ruby-identifier">docs</span> = {}
  <span class="ruby-identifier">offset</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">number</span> = <span class="ruby-value">500</span>
  <span class="ruby-keyword">while</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">execute_query</span>({
      <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span><span class="ruby-operator">+</span><span class="ruby-string">&#39;docs&#39;</span>,
      <span class="ruby-value">:query</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&quot;filter&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{CORPUS_TITLE_FIELD}:&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">corpus</span>,
        <span class="ruby-string">&quot;first&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">offset</span>,
        <span class="ruby-string">&quot;number&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">number</span>,
        <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>
      }
    })
    <span class="ruby-identifier">resp</span>[<span class="ruby-string">&quot;docs&quot;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">doc_info</span> = <span class="ruby-identifier">doc</span>[<span class="ruby-string">&quot;docInfo&quot;</span>]
      <span class="ruby-identifier">docs</span>[<span class="ruby-identifier">doc</span>[<span class="ruby-string">&quot;docPid&quot;</span>]] = {<span class="ruby-string">&quot;token_count&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">doc_info</span>[<span class="ruby-string">&quot;lengthInTokens&quot;</span>], <span class="ruby-string">&quot;corpus&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">corpus</span>, <span class="ruby-string">&quot;collection&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">doc_info</span>[<span class="ruby-constant">COLLECTION_TITLE_FIELD</span>]}
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">&quot;summary&quot;</span>][<span class="ruby-string">&quot;windowHasNext&quot;</span>]
    <span class="ruby-identifier">offset</span> = <span class="ruby-identifier">offset</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">number</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">docs</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_counter_node" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_counter_node</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Get node containing total counts for all node labels in index, not
implemented for BlackLab</p>
          
          

          
          <div class="method-source-code" id="get_counter_node-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 135</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_counter_node</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_document_audio_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_document_audio_file</span><span
            class="method-args">(xmlid)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Get the filename of the audio file for a specific document ID</p>
          
          

          
          <div class="method-source-code" id="get_document_audio_file-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 139</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_document_audio_file</span>(<span class="ruby-identifier">xmlid</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">get_document_metadata</span>(<span class="ruby-identifier">xmlid</span>)[<span class="ruby-string">&quot;Metadata&quot;</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&quot;AudioExportFormat&quot;</span>)
    <span class="ruby-identifier">format</span> = <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;AudioExportFormat&quot;</span>]
    <span class="ruby-identifier">format</span> = <span class="ruby-identifier">format</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">format</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">format</span>
    <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;#{format}/#{xmlid}.#{format}&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;Unknown&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_document_content" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_document_content</span><span
            class="method-args">(xmlid, patt, offset, number)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve the paginated content for a document ID. The query pattern is
currently not sent to the backend, which effectively disables query
highlighting. Currently, the only way to enable it is to retrieve the
entire document. We have decided against that approach to save bandwidth.</p>
          
          

          
          <div class="method-source-code" id="get_document_content-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 151</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_document_content</span>(<span class="ruby-identifier">xmlid</span>, <span class="ruby-identifier">patt</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">number</span>)
  <span class="ruby-identifier">data</span> = {
    <span class="ruby-string">&quot;audio_file&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">get_document_audio_file</span>(<span class="ruby-identifier">xmlid</span>),
    <span class="ruby-string">&quot;total_sentence_count&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">get_document_sentence_count</span>(<span class="ruby-identifier">xmlid</span>)
  }
  <span class="ruby-identifier">sdata</span> = []
  <span class="ruby-identifier">sentences</span> = <span class="ruby-identifier">get_document_sentence_starts</span>(<span class="ruby-identifier">xmlid</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">number</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>)[<span class="ruby-string">&quot;hits&quot;</span>]
  <span class="ruby-identifier">sentence_count</span> = <span class="ruby-identifier">sentences</span>.<span class="ruby-identifier">length</span>
  (<span class="ruby-identifier">offset</span><span class="ruby-operator">..</span><span class="ruby-identifier">offset</span><span class="ruby-operator">+</span><span class="ruby-identifier">number</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>).<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sentence_number</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">next_index</span> = <span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">sentence_count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">next_index</span>
      <span class="ruby-identifier">snippet_length</span> = <span class="ruby-identifier">sentences</span>[<span class="ruby-identifier">next_index</span>][<span class="ruby-string">&quot;start&quot;</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">snippet_length</span> = <span class="ruby-constant">ENABLE_METADATA_FILTERING</span> <span class="ruby-operator">?</span> <span class="ruby-constant">MetadataHandler</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">get_document_token_count</span>(<span class="ruby-identifier">xmlid</span>) <span class="ruby-operator">:</span> <span class="ruby-value">1000</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">sentence_count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">index</span>
      <span class="ruby-identifier">sentence</span> = <span class="ruby-identifier">get_document_snippet</span>(<span class="ruby-identifier">xmlid</span>, <span class="ruby-identifier">sentences</span>[<span class="ruby-identifier">index</span>][<span class="ruby-string">&quot;start&quot;</span>], <span class="ruby-identifier">snippet_length</span>)
      <span class="ruby-identifier">sdata</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sentence</span>[<span class="ruby-string">&quot;match&quot;</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;content&quot;</span>] = <span class="ruby-identifier">reformat_content</span>(<span class="ruby-identifier">xmlid</span>, <span class="ruby-identifier">sdata</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_document_id_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_document_id_list</span><span
            class="method-args">(filter)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve a filtered list of document IDs</p>
          
          

          
          <div class="method-source-code" id="get_document_id_list-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 239</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_document_id_list</span>(<span class="ruby-identifier">filter</span>)
  <span class="ruby-identifier">docs</span> = []
  <span class="ruby-identifier">offset</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">number</span> = <span class="ruby-value">500</span>
  <span class="ruby-keyword">while</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">execute_query</span>({
      <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span><span class="ruby-operator">+</span><span class="ruby-string">&#39;docs&#39;</span>,
      <span class="ruby-value">:query</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>,
        <span class="ruby-string">&quot;filter&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">reformat_filters</span>(<span class="ruby-identifier">filter</span>),
        <span class="ruby-string">&quot;first&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">offset</span>,
        <span class="ruby-string">&quot;number&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">number</span>
      }
    })
    <span class="ruby-identifier">resp</span>[<span class="ruby-string">&quot;docs&quot;</span>].<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">docs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">doc</span>[<span class="ruby-string">&quot;docPid&quot;</span>] }
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">&quot;summary&quot;</span>][<span class="ruby-string">&quot;windowHasNext&quot;</span>]
    <span class="ruby-identifier">offset</span> = <span class="ruby-identifier">offset</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">number</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">docs</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_document_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_document_list</span><span
            class="method-args">(offset, number)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve a paginated document list without a query</p>
          
          

          
          <div class="method-source-code" id="get_document_list-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 177</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_document_list</span>(<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">number</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">execute_query</span>({
    <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span><span class="ruby-operator">+</span><span class="ruby-string">&#39;docs&#39;</span>,
    <span class="ruby-value">:query</span> =<span class="ruby-operator">&gt;</span> {
      <span class="ruby-string">&quot;first&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">offset</span>,
      <span class="ruby-string">&quot;number&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">number</span>,
      <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>
    }
  })
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_document_metadata" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_document_metadata</span><span
            class="method-args">(xmlid)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve the metadata for a specific document ID</p>
          
          

          
          <div class="method-source-code" id="get_document_metadata-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 261</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_document_metadata</span>(<span class="ruby-identifier">xmlid</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">execute_query</span>({
    <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span><span class="ruby-operator">+</span><span class="ruby-string">&#39;docs/&#39;</span><span class="ruby-operator">+</span><span class="ruby-identifier">xmlid</span>,
    <span class="ruby-value">:query</span> =<span class="ruby-operator">&gt;</span> {
      <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>
    }
  })
  <span class="ruby-identifier">metadata</span> = {
    <span class="ruby-string">&quot;Metadata&quot;</span> =<span class="ruby-operator">&gt;</span> {}
  }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;docInfo&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">metadata</span>[<span class="ruby-string">&quot;Metadata&quot;</span>][<span class="ruby-identifier">key</span>] = [<span class="ruby-identifier">value</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">metadata</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_document_sentence_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_document_sentence_count</span><span
            class="method-args">(xmlid)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Get the sentence count for a specific document ID</p>
          
          

          
          <div class="method-source-code" id="get_document_sentence_count-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 278</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_document_sentence_count</span>(<span class="ruby-identifier">xmlid</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">execute_query</span>({
    <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span><span class="ruby-operator">+</span><span class="ruby-string">&#39;hits&#39;</span>,
    <span class="ruby-value">:query</span> =<span class="ruby-operator">&gt;</span> {
      <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>,
      <span class="ruby-string">&quot;patt&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;[xmlid=&quot;(p.[0-9]+.)*(s.)*[0-9]+.(w.)*1&quot;]&#39;</span>,
      <span class="ruby-string">&quot;filter&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;id:&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">xmlid</span>,
      <span class="ruby-string">&quot;first&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
      <span class="ruby-string">&quot;number&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
    }
  })[<span class="ruby-string">&quot;summary&quot;</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;stillCounting&quot;</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-string">&#39;true&#39;</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">get_document_sentence_count</span>(<span class="ruby-identifier">xmlid</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;numberOfHits&quot;</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_document_sentence_starts" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_document_sentence_starts</span><span
            class="method-args">(xmlid, offset, number)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Get all token indices marking sentence starts for a specific document ID</p>
          
          

          
          <div class="method-source-code" id="get_document_sentence_starts-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 297</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_document_sentence_starts</span>(<span class="ruby-identifier">xmlid</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">number</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">execute_query</span>({
    <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span><span class="ruby-operator">+</span><span class="ruby-string">&#39;hits&#39;</span>,
    <span class="ruby-value">:query</span> =<span class="ruby-operator">&gt;</span> {
      <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>,
      <span class="ruby-string">&quot;patt&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;[xmlid=&quot;(p.[0-9]+.)*(s.)*[0-9]+.(w.)*1&quot;]&#39;</span>,
      <span class="ruby-string">&quot;filter&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;id:&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">xmlid</span>,
      <span class="ruby-string">&quot;first&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">offset</span>,
      <span class="ruby-string">&quot;number&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">number</span>
    }
  })
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_document_snippet" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_document_snippet</span><span
            class="method-args">(xmlid, hitstart, hitend)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve a content snippet for a specific document ID</p>
          
          

          
          <div class="method-source-code" id="get_document_snippet-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 311</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_document_snippet</span>(<span class="ruby-identifier">xmlid</span>, <span class="ruby-identifier">hitstart</span>, <span class="ruby-identifier">hitend</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">execute_query</span>({
    <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span><span class="ruby-operator">+</span><span class="ruby-string">&#39;docs/&#39;</span><span class="ruby-operator">+</span><span class="ruby-identifier">xmlid</span><span class="ruby-operator">+</span><span class="ruby-string">&#39;/snippet&#39;</span>,
    <span class="ruby-value">:query</span> =<span class="ruby-operator">&gt;</span> {
      <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>,
      <span class="ruby-string">&quot;hitstart&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hitstart</span>,
      <span class="ruby-string">&quot;hitend&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hitend</span>,
      <span class="ruby-string">&quot;wordsaroundhit&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    }
  })
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_document_statistics" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_document_statistics</span><span
            class="method-args">(xmlid)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve simple statistics for a specific document ID</p>
          
          

          
          <div class="method-source-code" id="get_document_statistics-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 324</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_document_statistics</span>(<span class="ruby-identifier">xmlid</span>)
  <span class="ruby-identifier">token_count</span> = <span class="ruby-constant">MetadataHandler</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">get_document_token_count</span>(<span class="ruby-identifier">xmlid</span>)
  <span class="ruby-identifier">contents</span> = <span class="ruby-identifier">get_document_snippet</span>(<span class="ruby-identifier">xmlid</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">token_count</span>)[<span class="ruby-string">&quot;match&quot;</span>]
  <span class="ruby-identifier">type_count</span> = <span class="ruby-identifier">contents</span>[<span class="ruby-string">&quot;word&quot;</span>].<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-identifier">lemma_count</span> = <span class="ruby-identifier">contents</span>[<span class="ruby-string">&quot;lemma&quot;</span>].<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">count</span>
  
  <span class="ruby-keyword">return</span> {
    <span class="ruby-string">&quot;token_count&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">token_count</span>,
    <span class="ruby-string">&quot;type_count&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">type_count</span>,
    <span class="ruby-string">&quot;lemma_count&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">lemma_count</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_document_xml_content" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_document_xml_content</span><span
            class="method-args">(xmlid)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve the entire XML contents of a document ID without a query</p>
          
          

          
          <div class="method-source-code" id="get_document_xml_content-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 207</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_document_xml_content</span>(<span class="ruby-identifier">xmlid</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">execute_query</span>({
    <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{backend_url}docs/#{xmlid}&quot;</span>
  })
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_filtered_content" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_filtered_content</span><span
            class="method-args">(query)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve the concatenated contents of a set of filtered documents (for
vocabulary growth calculation)</p>
          
          

          
          <div class="method-source-code" id="get_filtered_content-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 338</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_filtered_content</span>(<span class="ruby-identifier">query</span>)
  <span class="ruby-identifier">contents</span> = []
  <span class="ruby-identifier">get_filtered_document_list</span>(<span class="ruby-identifier">query</span>.<span class="ruby-identifier">filter</span>).<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">doc_id</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">contents</span> = <span class="ruby-identifier">contents</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">get_document_content</span>(<span class="ruby-identifier">doc_id</span>, <span class="ruby-identifier">query</span>.<span class="ruby-identifier">patt</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">get_document_sentence_count</span>(<span class="ruby-identifier">doc_id</span>))
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">contents</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_filtered_document_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_filtered_document_list</span><span
            class="method-args">(filter, offset, number)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve a filtered paginated document list without a query</p>
          
          

          
          <div class="method-source-code" id="get_filtered_document_list-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 189</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_filtered_document_list</span>(<span class="ruby-identifier">filter</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">number</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">execute_query</span>({
    <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span><span class="ruby-operator">+</span><span class="ruby-string">&#39;docs&#39;</span>,
    <span class="ruby-value">:query</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ENABLE_METADATA_FILTERING</span> <span class="ruby-operator">?</span> {
      <span class="ruby-string">&quot;filter&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filter</span>,
      <span class="ruby-string">&quot;first&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">offset</span>,
      <span class="ruby-string">&quot;number&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">number</span>,
      <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>
    } <span class="ruby-operator">:</span> {
      <span class="ruby-string">&quot;patt&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filter</span>,
      <span class="ruby-string">&quot;first&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">offset</span>,
      <span class="ruby-string">&quot;number&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">number</span>,
      <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>
    }
  })
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_kwic" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_kwic</span><span
            class="method-args">(docpid, first_index, last_index, size = 50)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve a keyword in context</p>
          
          

          
          <div class="method-source-code" id="get_kwic-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 347</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_kwic</span>(<span class="ruby-identifier">docpid</span>, <span class="ruby-identifier">first_index</span>, <span class="ruby-identifier">last_index</span>, <span class="ruby-identifier">size</span> = <span class="ruby-value">50</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">execute_query</span>({
    <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span><span class="ruby-operator">+</span><span class="ruby-string">&#39;docs/&#39;</span><span class="ruby-operator">+</span><span class="ruby-identifier">docpid</span><span class="ruby-operator">+</span><span class="ruby-string">&#39;/snippet&#39;</span>,
    <span class="ruby-value">:query</span> =<span class="ruby-operator">&gt;</span> {
      <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>,
      <span class="ruby-string">&quot;hitstart&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">first_index</span>,
      <span class="ruby-string">&quot;hitend&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">last_index</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>,
      <span class="ruby-string">&quot;wordsaroundhit&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">size</span>
    }
  })
  <span class="ruby-keyword">return</span> {
    <span class="ruby-string">&quot;left_context&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;left&quot;</span>][<span class="ruby-string">&quot;word&quot;</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>),
    <span class="ruby-string">&quot;hit_text&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;match&quot;</span>][<span class="ruby-string">&quot;word&quot;</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>),
    <span class="ruby-string">&quot;right_context&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;right&quot;</span>][<span class="ruby-string">&quot;word&quot;</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>)
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_metadata_from_server" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_metadata_from_server</span><span
            class="method-args">(number, offset, sort, order)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve a list of metadata fields from the backend</p>
          
          

          
          <div class="method-source-code" id="get_metadata_from_server-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 365</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_metadata_from_server</span>(<span class="ruby-identifier">number</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">sort</span>, <span class="ruby-identifier">order</span>)
  <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">execute_query</span>({
    <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span>,
    <span class="ruby-value">:query</span> =<span class="ruby-operator">&gt;</span> {
      <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>
    }
  })
  <span class="ruby-identifier">fields</span> = <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&quot;metadataFields&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">&quot;metadataFields&quot;</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">&quot;fieldInfo&quot;</span>][<span class="ruby-string">&quot;metadataFields&quot;</span>]
  <span class="ruby-identifier">wanted</span> = <span class="ruby-identifier">number</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">fields</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">keys</span>[<span class="ruby-identifier">offset</span><span class="ruby-operator">..</span><span class="ruby-identifier">offset</span><span class="ruby-operator">+</span><span class="ruby-identifier">number</span>]
  <span class="ruby-identifier">data</span> = []
  <span class="ruby-identifier">fields</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">label</span>, <span class="ruby-identifier">field_data</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">group</span> = <span class="ruby-identifier">label</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;_&#39;</span>)[<span class="ruby-value">0</span>]
    <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> { <span class="ruby-value">:label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">label</span>, <span class="ruby-value">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">group</span>, <span class="ruby-value">:key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">label</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-node">/#{group}_/</span>,<span class="ruby-string">&#39;&#39;</span>) } <span class="ruby-keyword">if</span> <span class="ruby-identifier">wanted</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">label</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_metadatum_values_by_label" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_metadatum_values_by_label</span><span
            class="method-args">(number, offset, sort, order, label)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Load metadatum values by label</p>
          
          

          
          <div class="method-source-code" id="get_metadatum_values_by_label-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 383</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_metadatum_values_by_label</span>(<span class="ruby-identifier">number</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">sort</span>, <span class="ruby-identifier">order</span>, <span class="ruby-identifier">label</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">label</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">execute_query</span>({
    <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span><span class="ruby-operator">+</span><span class="ruby-string">&#39;fields/&#39;</span><span class="ruby-operator">+</span><span class="ruby-identifier">label</span>,
    <span class="ruby-value">:query</span> =<span class="ruby-operator">&gt;</span> {
      <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>
    }
  })
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">number</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">&quot;fieldValues&quot;</span>].<span class="ruby-identifier">keys</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">&quot;fieldValues&quot;</span>].<span class="ruby-identifier">keys</span>[<span class="ruby-identifier">offset</span><span class="ruby-operator">..</span><span class="ruby-identifier">offset</span><span class="ruby-operator">+</span><span class="ruby-identifier">number</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_pos_head_counts" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_pos_head_counts</span><span
            class="method-args">(head)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve the frequency of a specific PoS head tag from the backend</p>
          
          

          
          <div class="method-source-code" id="get_pos_head_counts-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 414</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_pos_head_counts</span>(<span class="ruby-identifier">head</span>)
  <span class="ruby-identifier">obj</span> = {
    <span class="ruby-string">&quot;label&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">head</span>,
    <span class="ruby-string">&quot;token_count&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  }
  <span class="ruby-constant">MetadataHandler</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">load_corpora</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">corpus</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">while</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">execute_query</span>({
        <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span><span class="ruby-operator">+</span><span class="ruby-string">&quot;/hits&quot;</span>,
        <span class="ruby-value">:query</span> =<span class="ruby-operator">&gt;</span> {  
          <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>,
          <span class="ruby-string">&quot;patt&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;[pos=\&quot;#{head}.*\&quot;]&quot;</span>, 
          <span class="ruby-string">&quot;group&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;hit:pos&quot;</span>,
          <span class="ruby-string">&quot;filter&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{CORPUS_TITLE_FIELD}:&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">corpus</span>
        }
      })[<span class="ruby-string">&quot;summary&quot;</span>]
      <span class="ruby-keyword">break</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">&quot;stillCounting&quot;</span>]
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">hit_count</span> = <span class="ruby-identifier">resp</span>[<span class="ruby-string">&quot;numberOfHits&quot;</span>]
    <span class="ruby-identifier">obj</span>[<span class="ruby-string">&quot;token_count&quot;</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">hit_count</span>
    <span class="ruby-identifier">obj</span>[<span class="ruby-string">&quot;token_count_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">corpus</span>] = <span class="ruby-identifier">hit_count</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">obj</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_pos_heads_counted" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_pos_heads_counted</span><span
            class="method-args">(number, offset, sort, order)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retrieve a list of PoS head tags and their frequencies from the backend</p>
          
          

          
          <div class="method-source-code" id="get_pos_heads_counted-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 395</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_pos_heads_counted</span>(<span class="ruby-identifier">number</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">sort</span>, <span class="ruby-identifier">order</span>)
  <span class="ruby-identifier">data</span> = [<span class="ruby-string">&#39;ADJ&#39;</span>, <span class="ruby-string">&#39;BW&#39;</span>, <span class="ruby-string">&#39;LET&#39;</span>, <span class="ruby-string">&#39;LID&#39;</span>, <span class="ruby-string">&#39;N&#39;</span>, <span class="ruby-string">&#39;SPEC&#39;</span>, <span class="ruby-string">&#39;TW&#39;</span>, <span class="ruby-string">&#39;TSW&#39;</span>, <span class="ruby-string">&#39;VG&#39;</span>, <span class="ruby-string">&#39;VNW&#39;</span>, <span class="ruby-string">&#39;VZ&#39;</span>, <span class="ruby-string">&#39;WW&#39;</span>]
  <span class="ruby-identifier">ph</span> = {
    <span class="ruby-string">&quot;total&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">size</span>,
    <span class="ruby-string">&quot;number&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">number</span>,
    <span class="ruby-string">&quot;offset&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">offset</span>,
    <span class="ruby-string">&quot;sort&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sort</span>,
    <span class="ruby-string">&quot;order&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">order</span>,
    <span class="ruby-string">&quot;pos_heads&quot;</span> =<span class="ruby-operator">&gt;</span> []
  }
  <span class="ruby-identifier">data</span>[<span class="ruby-identifier">offset</span><span class="ruby-operator">..</span><span class="ruby-identifier">offset</span><span class="ruby-operator">+</span><span class="ruby-identifier">number</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">head</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">ph</span>[<span class="ruby-string">&quot;pos_heads&quot;</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">get_pos_head_counts</span>(<span class="ruby-identifier">head</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">ph</span>[<span class="ruby-string">&quot;pos_heads&quot;</span>].<span class="ruby-identifier">sort_by!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span>[<span class="ruby-identifier">sort</span>] }
  <span class="ruby-identifier">ph</span>[<span class="ruby-string">&quot;pos_heads&quot;</span>] = <span class="ruby-identifier">ph</span>[<span class="ruby-string">&quot;pos_heads&quot;</span>].<span class="ruby-identifier">reverse</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">order</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-string">&quot;desc&quot;</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">ph</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_pos_tag_by_label" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_pos_tag_by_label</span><span
            class="method-args">(label)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Get PoS tag by label</p>
          
          

          
          <div class="method-source-code" id="get_pos_tag_by_label-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 440</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_pos_tag_by_label</span>(<span class="ruby-identifier">label</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">reformat_pos_tag</span>({ <span class="ruby-string">&quot;label&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">label</span> })
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_pos_tag_features_by_label" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_pos_tag_features_by_label</span><span
            class="method-args">(label)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Get PoS tag feature by label</p>
          
          

          
          <div class="method-source-code" id="get_pos_tag_features_by_label-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 445</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_pos_tag_features_by_label</span>(<span class="ruby-identifier">label</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">label</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\(/</span>)[<span class="ruby-value">1</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/\)^/</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/,/</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">feat</span><span class="ruby-operator">|</span>
    { <span class="ruby-string">&quot;key&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;unknown&quot;</span>, <span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">feat</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_pos_tag_types_by_label" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_pos_tag_types_by_label</span><span
            class="method-args">(number, offset, sort, order, label)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Get PoS tag type by label</p>
          
          

          
          <div class="method-source-code" id="get_pos_tag_types_by_label-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 452</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_pos_tag_types_by_label</span>(<span class="ruby-identifier">number</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">sort</span>, <span class="ruby-identifier">order</span>, <span class="ruby-identifier">label</span>)
  <span class="ruby-identifier">pid</span> = <span class="ruby-identifier">label</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\(/</span>,<span class="ruby-string">&#39;\(&#39;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\)/</span>,<span class="ruby-string">&#39;\)&#39;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\-/</span>,<span class="ruby-string">&#39;\-&#39;</span>)
  <span class="ruby-identifier">patt</span> = <span class="ruby-node">&quot;[pos=\&quot;#{pid}\&quot;]&quot;</span>
  <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">execute_query</span>({
    <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span><span class="ruby-operator">+</span><span class="ruby-string">&quot;/hits&quot;</span>,
    <span class="ruby-value">:query</span> =<span class="ruby-operator">&gt;</span> {  
      <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>,
      <span class="ruby-string">&quot;patt&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">patt</span>, 
      <span class="ruby-string">&quot;group&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;hit:word&quot;</span>,
      <span class="ruby-string">&quot;number&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">number</span>,
      <span class="ruby-string">&quot;first&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">offset</span>,
      <span class="ruby-string">&quot;sort&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;size&quot;</span>
    }
  })
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">&quot;hitGroups&quot;</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hit</span><span class="ruby-operator">|</span>
    { <span class="ruby-string">&quot;word_type&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;identityDisplay&quot;</span>], <span class="ruby-string">&quot;token_count&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;size&quot;</span>]}
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_pos_tags" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_pos_tags</span><span
            class="method-args">(number, offset, sort, order)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Get PoS tags</p>
          
          

          
          <div class="method-source-code" id="get_pos_tags-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 472</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_pos_tags</span>(<span class="ruby-identifier">number</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">sort</span>, <span class="ruby-identifier">order</span>)
  <span class="ruby-keyword">while</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">execute_query</span>({
      <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span><span class="ruby-operator">+</span><span class="ruby-string">&quot;/hits&quot;</span>,
      <span class="ruby-value">:query</span> =<span class="ruby-operator">&gt;</span> {  
        <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>,
        <span class="ruby-string">&quot;patt&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[\&quot;..*\&quot;]&quot;</span>, 
        <span class="ruby-string">&quot;group&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;hit:pos&quot;</span>,
        <span class="ruby-string">&quot;number&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">number</span>,
        <span class="ruby-string">&quot;first&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">offset</span>,
        <span class="ruby-string">&quot;sort&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">order</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-string">&quot;desc&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-node">&quot;-#{sort}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">sort</span>
      }
    })
    <span class="ruby-identifier">summary</span> = <span class="ruby-identifier">resp</span>[<span class="ruby-string">&quot;summary&quot;</span>]
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">summary</span>[<span class="ruby-string">&quot;stillCounting&quot;</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> { <span class="ruby-string">&#39;total&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">summary</span>[<span class="ruby-string">&quot;numberOfGroups&quot;</span>], <span class="ruby-string">&#39;pos_tags&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">&quot;hitGroups&quot;</span>].<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">hit_group</span><span class="ruby-operator">|</span> <span class="ruby-identifier">reformat_pos_tag</span>(<span class="ruby-identifier">hit_group</span>) } }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">name</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Get human readable name of backend</p>
          
          

          
          <div class="method-source-code" id="name-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 492</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">name</span>
  <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;BlackLab Server&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-query_to_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">query_to_url</span><span
            class="method-args">(query)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Get the base URL for a query based on the selected view</p>
          
          

          
          <div class="method-source-code" id="query_to_url-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 15</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">query_to_url</span>(<span class="ruby-identifier">query</span>)
  <span class="ruby-identifier">page</span> = [<span class="ruby-value">1</span>,<span class="ruby-value">8</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">query</span>.<span class="ruby-identifier">view</span>) <span class="ruby-operator">?</span> <span class="ruby-string">&quot;hits&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;docs&quot;</span>
  <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;#{backend_url}#{page}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reformat_content" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reformat_content</span><span
            class="method-args">(xmlid, data)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reformat BlackLab content output to match the format expected by WhiteLab</p>
          
          

          
          <div class="method-source-code" id="reformat_content-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 497</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reformat_content</span>(<span class="ruby-identifier">xmlid</span>, <span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">token_index</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">reformat</span> = []
  <span class="ruby-identifier">data</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sentence</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">arr</span>, <span class="ruby-identifier">token_index</span> = <span class="ruby-identifier">reformat_sentence_content</span>(<span class="ruby-identifier">xmlid</span>, <span class="ruby-identifier">sentence</span>, <span class="ruby-identifier">token_index</span>)
    <span class="ruby-identifier">reformat</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">arr</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">reformat</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reformat_field_content" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reformat_field_content</span><span
            class="method-args">(obj, field, token)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reformat BlackLab field content output to match the format expected by
WhiteLab</p>
          
          

          
          <div class="method-source-code" id="reformat_field_content-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 534</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reformat_field_content</span>(<span class="ruby-identifier">obj</span>, <span class="ruby-identifier">field</span>, <span class="ruby-identifier">token</span>)
  <span class="ruby-identifier">sentence_field</span> = <span class="ruby-identifier">obj</span>[<span class="ruby-value">:sentence</span>][<span class="ruby-identifier">field</span>][<span class="ruby-identifier">obj</span>[<span class="ruby-value">:index</span>]]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-string">&quot;pos&quot;</span>)
    <span class="ruby-identifier">token</span>[<span class="ruby-identifier">field</span><span class="ruby-operator">+</span><span class="ruby-string">&quot;_tag&quot;</span>] = <span class="ruby-identifier">sentence_field</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-string">&quot;speaker&quot;</span>)
    <span class="ruby-identifier">token</span>[<span class="ruby-string">&quot;sentence_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">field</span>] = <span class="ruby-identifier">sentence_field</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-string">&quot;xmlid&quot;</span>)
    <span class="ruby-identifier">token</span>[<span class="ruby-identifier">field</span>] = <span class="ruby-identifier">obj</span>[<span class="ruby-value">:xmlid</span>]<span class="ruby-operator">+</span><span class="ruby-string">&quot;.&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">sentence_field</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">sentence_field</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\.(s\.)*1\.(w\.)*1$/</span>
      <span class="ruby-identifier">token</span>[<span class="ruby-string">&quot;paragraph_start&quot;</span>] = <span class="ruby-string">&quot;true&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">token</span>[<span class="ruby-string">&quot;paragraph_start&quot;</span>] = <span class="ruby-string">&quot;false&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">sentence_field</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\.(w\.)*1$/</span>
      <span class="ruby-identifier">token</span>[<span class="ruby-string">&quot;sentence_start&quot;</span>] = <span class="ruby-string">&quot;true&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">token</span>[<span class="ruby-string">&quot;sentence_start&quot;</span>] = <span class="ruby-string">&quot;false&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">obj</span>[<span class="ruby-value">:sentence</span>].<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">field</span>)
    <span class="ruby-identifier">token</span>[<span class="ruby-identifier">field</span>] = <span class="ruby-identifier">sentence_field</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">token</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reformat_filters" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reformat_filters</span><span
            class="method-args">(filters)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reformat filters to BlackLab format (filter:value)</p>
          
          

          
          <div class="method-source-code" id="reformat_filters-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 559</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reformat_filters</span>(<span class="ruby-identifier">filters</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">filters</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">filters</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;=&#39;</span>,<span class="ruby-string">&#39;:&#39;</span>).<span class="ruby-identifier">sub</span>(<span class="ruby-string">&#39;Metadata_&#39;</span>,<span class="ruby-string">&#39;&#39;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reformat_group" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reformat_group</span><span
            class="method-args">(group)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reformat group to BlackLab format</p>
          
          

          
          <div class="method-source-code" id="reformat_group-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 567</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reformat_group</span>(<span class="ruby-identifier">group</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">group</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-string">&#39;hit&#39;</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-string">&#39;word&#39;</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-string">&#39;context&#39;</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">group</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;field:&#39;</span><span class="ruby-operator">+</span><span class="ruby-identifier">group</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-string">&#39;Metadata_&#39;</span>,<span class="ruby-string">&#39;&#39;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reformat_output" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reformat_output</span><span
            class="method-args">(response, key, query)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reformat BlackLab Server output to match the format expected by WhiteLab</p>
          
          

          
          <div class="method-source-code" id="reformat_output-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 65</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reformat_output</span>(<span class="ruby-identifier">response</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">query</span>)
  <span class="ruby-identifier">view</span> = <span class="ruby-identifier">query</span>.<span class="ruby-identifier">view</span>
  <span class="ruby-keyword">return</span> {
    <span class="ruby-string">&#39;error&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{response[&#39;error&#39;][&#39;code&#39;]}: #{response[&#39;error&#39;][&#39;message&#39;]}&quot;</span>
  } <span class="ruby-keyword">unless</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">key</span>)
  <span class="ruby-identifier">summary</span> = <span class="ruby-identifier">response</span>[<span class="ruby-string">&#39;summary&#39;</span>]
  <span class="ruby-identifier">hits</span> = <span class="ruby-identifier">summary</span>[<span class="ruby-string">&#39;numberOfHits&#39;</span>]
  <span class="ruby-identifier">docs</span> = <span class="ruby-identifier">summary</span>[<span class="ruby-string">&#39;numberOfDocs&#39;</span>]
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">response</span>[<span class="ruby-identifier">key</span>]
  <span class="ruby-keyword">return</span> {
    <span class="ruby-string">&#39;hit_count&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hits</span>,
    <span class="ruby-string">&#39;document_count&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">docs</span>,
    <span class="ruby-string">&#39;documents&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">response</span>[<span class="ruby-string">&#39;docInfos&#39;</span>],
    <span class="ruby-string">&#39;sampleseed&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">response</span>[<span class="ruby-string">&#39;summary&#39;</span>].<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&#39;sampleSeed&#39;</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">response</span>[<span class="ruby-string">&#39;summary&#39;</span>][<span class="ruby-string">&#39;sampleSeed&#39;</span>] <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
    <span class="ruby-string">&#39;results&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">hit</span><span class="ruby-operator">|</span>
      {
        <span class="ruby-string">&quot;corpus&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">response</span>[<span class="ruby-string">&#39;docInfos&#39;</span>][<span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;docPid&quot;</span>]][<span class="ruby-constant">CORPUS_TITLE_FIELD</span>],
        <span class="ruby-string">&quot;collection&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">response</span>[<span class="ruby-string">&#39;docInfos&#39;</span>][<span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;docPid&quot;</span>]][<span class="ruby-constant">COLLECTION_TITLE_FIELD</span>],
        <span class="ruby-string">&quot;docpid&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;docPid&quot;</span>],
        <span class="ruby-string">&quot;text_left&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;left&quot;</span>][<span class="ruby-string">&quot;word&quot;</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>),
        <span class="ruby-string">&quot;hit_text&quot;</span>=<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;match&quot;</span>][<span class="ruby-string">&quot;word&quot;</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>),
        <span class="ruby-string">&quot;text_right&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;right&quot;</span>][<span class="ruby-string">&quot;word&quot;</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>),
        <span class="ruby-string">&quot;hit_pos&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;match&quot;</span>].<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&quot;pos&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;match&quot;</span>][<span class="ruby-string">&quot;pos&quot;</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
        <span class="ruby-string">&quot;hit_phonetic&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;match&quot;</span>].<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&quot;phonetic&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">reformat_phonetic</span>(<span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;match&quot;</span>][<span class="ruby-string">&quot;phonetic&quot;</span>]) <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
        <span class="ruby-string">&quot;hit_lemma&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;match&quot;</span>].<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&quot;lemma&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;match&quot;</span>][<span class="ruby-string">&quot;lemma&quot;</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
        <span class="ruby-string">&quot;first_index&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;start&quot;</span>],
        <span class="ruby-string">&quot;last_index&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;end&quot;</span>]<span class="ruby-operator">-</span><span class="ruby-value">1</span>,
        <span class="ruby-string">&quot;end_time&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;match&quot;</span>].<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&quot;end_time&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;match&quot;</span>][<span class="ruby-string">&quot;end_time&quot;</span>].<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">et</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">et</span>.<span class="ruby-identifier">blank?</span> }.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
        <span class="ruby-string">&quot;begin_time&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;match&quot;</span>].<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&quot;begin_time&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">hit</span>[<span class="ruby-string">&quot;match&quot;</span>][<span class="ruby-string">&quot;begin_time&quot;</span>].<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">bt</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">bt</span>.<span class="ruby-identifier">blank?</span> }.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
      }
    }
  } <span class="ruby-keyword">if</span> <span class="ruby-identifier">view</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
  <span class="ruby-keyword">return</span> {
    <span class="ruby-string">&#39;hit_count&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hits</span>,
    <span class="ruby-string">&#39;document_count&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">docs</span>,
    <span class="ruby-string">&#39;sampleseed&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">response</span>[<span class="ruby-string">&#39;summary&#39;</span>].<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&#39;sampleSeed&#39;</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">response</span>[<span class="ruby-string">&#39;summary&#39;</span>][<span class="ruby-string">&#39;sampleSeed&#39;</span>] <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
    <span class="ruby-string">&#39;results&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span>
      {
        <span class="ruby-string">&quot;corpus&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">doc</span>[<span class="ruby-string">&quot;docInfo&quot;</span>][<span class="ruby-constant">CORPUS_TITLE_FIELD</span>],
        <span class="ruby-string">&quot;collection&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">doc</span>[<span class="ruby-string">&quot;docInfo&quot;</span>][<span class="ruby-constant">COLLECTION_TITLE_FIELD</span>],
        <span class="ruby-string">&quot;docpid&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">doc</span>[<span class="ruby-string">&quot;docPid&quot;</span>],
        <span class="ruby-string">&quot;hit_count&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">doc</span>[<span class="ruby-string">&quot;numberOfHits&quot;</span>],
        <span class="ruby-string">&quot;relative_hit_count&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&quot;numberOfHits&quot;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">hits</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> (<span class="ruby-identifier">doc</span>[<span class="ruby-string">&quot;numberOfHits&quot;</span>].<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">hits</span>) <span class="ruby-operator">*</span> <span class="ruby-value">100</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>,
        <span class="ruby-string">&quot;metadata&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">doc</span>[<span class="ruby-string">&quot;docInfo&quot;</span>]
      }
    }
  } <span class="ruby-keyword">if</span> <span class="ruby-identifier">view</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
  <span class="ruby-keyword">return</span> {
    <span class="ruby-string">&#39;hit_count&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hits</span>,
    <span class="ruby-string">&#39;document_count&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">docs</span>,
    <span class="ruby-string">&#39;group_count&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">summary</span>[<span class="ruby-string">&#39;numberOfGroups&#39;</span>],
    <span class="ruby-string">&#39;largest_group_size&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">summary</span>[<span class="ruby-string">&#39;largestGroupSize&#39;</span>],
    <span class="ruby-string">&#39;sampleseed&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">response</span>[<span class="ruby-string">&#39;summary&#39;</span>].<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&#39;sampleSeed&#39;</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">response</span>[<span class="ruby-string">&#39;summary&#39;</span>][<span class="ruby-string">&#39;sampleSeed&#39;</span>] <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
    <span class="ruby-string">&#39;results&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">group</span><span class="ruby-operator">|</span>
      {
        <span class="ruby-string">&quot;identity&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">group</span>[<span class="ruby-string">&quot;identity&quot;</span>],
        <span class="ruby-node">&quot;#{query.group}&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query</span>.<span class="ruby-identifier">group</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/H(;|$)/</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">group</span>[<span class="ruby-string">&quot;identityDisplay&quot;</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/ \-/</span>, <span class="ruby-string">&#39;&#39;</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">group</span>[<span class="ruby-string">&quot;identityDisplay&quot;</span>],
        <span class="ruby-node">&quot;#{view == 8 ? &#39;hit_count&#39; : &#39;document_count&#39;}&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">group</span>[<span class="ruby-string">&quot;size&quot;</span>],
        <span class="ruby-node">&quot;relative_#{view == 8 ? &#39;hit_count&#39; : &#39;document_count&#39;}&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">view</span> <span class="ruby-operator">==</span> <span class="ruby-value">8</span> <span class="ruby-operator">?</span> (<span class="ruby-identifier">group</span>[<span class="ruby-string">&quot;size&quot;</span>].<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">hits</span>) <span class="ruby-operator">*</span> <span class="ruby-value">100</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">group</span>[<span class="ruby-string">&quot;size&quot;</span>].<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">docs</span>) <span class="ruby-operator">*</span> <span class="ruby-value">100</span>
      }
    }
  } <span class="ruby-keyword">if</span> [<span class="ruby-value">8</span>,<span class="ruby-value">16</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">view</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reformat_phonetic" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reformat_phonetic</span><span
            class="method-args">(phonetic)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reformat phonetic to BlackLab format</p>
          
          

          
          <div class="method-source-code" id="reformat_phonetic-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 579</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reformat_phonetic</span>(<span class="ruby-identifier">phonetic</span>)
  <span class="ruby-identifier">has_phonetic</span> = <span class="ruby-keyword">false</span>
  
  <span class="ruby-identifier">phonetic</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ph</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">ph</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> 
      <span class="ruby-identifier">has_phonetic</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_phonetic</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">phonetic</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reformat_pos_tag" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reformat_pos_tag</span><span
            class="method-args">(pos)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reformat PoS to BlackLab format</p>
          
          

          
          <div class="method-source-code" id="reformat_pos_tag-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 597</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reformat_pos_tag</span>(<span class="ruby-identifier">pos</span>)
  <span class="ruby-identifier">obj</span> = { <span class="ruby-string">&quot;label&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&quot;label&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">pos</span>[<span class="ruby-string">&quot;label&quot;</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">pos</span>[<span class="ruby-string">&quot;identityDisplay&quot;</span>], <span class="ruby-string">&quot;token_count&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> }
  <span class="ruby-constant">MetadataHandler</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">load_corpora</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">corpus</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">pid</span> = <span class="ruby-identifier">obj</span>[<span class="ruby-string">&quot;label&quot;</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\(/</span>,<span class="ruby-string">&#39;\(&#39;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\)/</span>,<span class="ruby-string">&#39;\)&#39;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\-/</span>,<span class="ruby-string">&#39;\-&#39;</span>)
    <span class="ruby-identifier">patt</span> = <span class="ruby-node">&quot;[pos=\&quot;#{pid}\&quot;]&quot;</span>
    <span class="ruby-keyword">while</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">execute_query</span>({
        <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span><span class="ruby-operator">+</span><span class="ruby-string">&quot;/hits&quot;</span>,
        <span class="ruby-value">:query</span> =<span class="ruby-operator">&gt;</span> {  
          <span class="ruby-string">&quot;outputformat&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;json&quot;</span>,
          <span class="ruby-string">&quot;patt&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">patt</span>,
          <span class="ruby-string">&quot;filter&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{CORPUS_TITLE_FIELD}:#{corpus}&quot;</span>
        },
        <span class="ruby-value">:headers</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">headers</span>
      })[<span class="ruby-string">&quot;summary&quot;</span>]
      <span class="ruby-keyword">break</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">&quot;stillCounting&quot;</span>]
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">hits</span> = <span class="ruby-identifier">resp</span>[<span class="ruby-string">&quot;numberOfHits&quot;</span>]
    <span class="ruby-identifier">obj</span>[<span class="ruby-string">&quot;token_count&quot;</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">hits</span>
    <span class="ruby-identifier">obj</span>[<span class="ruby-node">&quot;token_count_#{corpus}&quot;</span>] = <span class="ruby-identifier">hits</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">obj</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reformat_query_attributes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reformat_query_attributes</span><span
            class="method-args">(query)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reformat the WhiteLab query parameters to match BlackLab parameters</p>
          
          

          
          <div class="method-source-code" id="reformat_query_attributes-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 21</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reformat_query_attributes</span>(<span class="ruby-identifier">query</span>)
  <span class="ruby-identifier">attrs</span> = { <span class="ruby-string">&#39;outputformat&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;json&#39;</span> }
  <span class="ruby-identifier">query</span>.<span class="ruby-identifier">as_json</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">_</span><span class="ruby-operator">|</span> [<span class="ruby-string">&#39;patt&#39;</span>, <span class="ruby-string">&#39;filter&#39;</span>, <span class="ruby-string">&#39;group&#39;</span>, <span class="ruby-string">&#39;sort&#39;</span>, <span class="ruby-string">&#39;offset&#39;</span>, <span class="ruby-string">&#39;number&#39;</span>, <span class="ruby-string">&#39;docpid&#39;</span>, <span class="ruby-string">&#39;viewgroup&#39;</span>, <span class="ruby-string">&#39;sample&#39;</span>, <span class="ruby-string">&#39;samplenum&#39;</span>, <span class="ruby-string">&#39;sampleseed&#39;</span>, <span class="ruby-string">&#39;gap_values_tsv&#39;</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">key</span>) }.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">if</span> [<span class="ruby-string">&#39;filter&#39;</span>, <span class="ruby-string">&#39;group&#39;</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">key</span>)
        <span class="ruby-identifier">attrs</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">reformat_filters</span>(<span class="ruby-identifier">value</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-string">&#39;filter&#39;</span>)
        <span class="ruby-identifier">attrs</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">reformat_group</span>(<span class="ruby-identifier">value</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-string">&#39;group&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> ([<span class="ruby-value">8</span>,<span class="ruby-value">16</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">query</span>.<span class="ruby-identifier">view</span>) <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query</span>.<span class="ruby-identifier">viewgroup</span>.<span class="ruby-identifier">blank?</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">key</span> = <span class="ruby-string">&#39;first&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-string">&#39;offset&#39;</span>)
        <span class="ruby-identifier">value</span> = <span class="ruby-identifier">combine_patt_and_within</span>(<span class="ruby-identifier">query</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-string">&#39;patt&#39;</span>)
        <span class="ruby-identifier">attrs</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">attrs</span>[<span class="ruby-string">&quot;sort&quot;</span>] = <span class="ruby-string">&quot;size&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&quot;group&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&quot;sort&quot;</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&quot;viewgroup&quot;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">query</span>.<span class="ruby-identifier">view</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">attrs</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reformat_sentence_content" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reformat_sentence_content</span><span
            class="method-args">(xmlid, sentence, token_index)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reformat BlackLab sentence content output to match the format expected by
WhiteLab</p>
          
          

          
          <div class="method-source-code" id="reformat_sentence_content-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 508</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reformat_sentence_content</span>(<span class="ruby-identifier">xmlid</span>, <span class="ruby-identifier">sentence</span>, <span class="ruby-identifier">token_index</span>)
  <span class="ruby-identifier">reformat</span> = []
  <span class="ruby-identifier">sentence</span>[<span class="ruby-string">&quot;word&quot;</span>].<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">word</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">token_index</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">obj</span> = {
      <span class="ruby-value">:token_index</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">token_index</span>,
      <span class="ruby-value">:xmlid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">xmlid</span>,
      <span class="ruby-value">:sentence</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sentence</span>,
      <span class="ruby-value">:word</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">word</span>,
      <span class="ruby-value">:index</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">index</span>
    }
    <span class="ruby-identifier">reformat</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">reformat_word_content</span>(<span class="ruby-identifier">obj</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">reformat</span>, <span class="ruby-identifier">token_index</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reformat_word_content" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reformat_word_content</span><span
            class="method-args">(obj)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reformat BlackLab word content output to match the format expected by
WhiteLab</p>
          
          

          
          <div class="method-source-code" id="reformat_word_content-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 525</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reformat_word_content</span>(<span class="ruby-identifier">obj</span>)
  <span class="ruby-identifier">token</span> = { <span class="ruby-string">&quot;word_type&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">obj</span>[<span class="ruby-value">:word</span>], <span class="ruby-string">&quot;token_index&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">obj</span>[<span class="ruby-value">:token_index</span>] }
  [<span class="ruby-string">&quot;lemma&quot;</span>, <span class="ruby-string">&quot;pos&quot;</span>, <span class="ruby-string">&quot;phonetic&quot;</span>, <span class="ruby-string">&quot;xmlid&quot;</span>, <span class="ruby-string">&quot;speaker&quot;</span>, <span class="ruby-string">&quot;begin_time&quot;</span>, <span class="ruby-string">&quot;end_time&quot;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">token</span> = <span class="ruby-identifier">reformat_field_content</span>(<span class="ruby-identifier">obj</span>, <span class="ruby-identifier">field</span>, <span class="ruby-identifier">token</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">token</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-run_benchmark_test" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run_benchmark_test</span><span
            class="method-args">(cql,iterations)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Run CQL query on server for set amount of iterations, not implemented for
BlackLab</p>
          
          

          
          <div class="method-source-code" id="run_benchmark_test-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 622</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">run_benchmark_test</span>(<span class="ruby-identifier">cql</span>,<span class="ruby-identifier">iterations</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-version" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">version</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Get the current version of the backend. This will be implemented in
BlackLab Server 1.6.0.</p>
          
          

          
          <div class="method-source-code" id="version-source">
            <pre><span class="ruby-comment"># File app/helpers/blacklab_helper.rb, line 626</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">version</span>
  <span class="ruby-identifier">response</span> = <span class="ruby-identifier">get_headers</span>({ <span class="ruby-value">:url</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">backend_url</span> }).<span class="ruby-identifier">parsed_response</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&quot;blacklabVersion&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">response</span>[<span class="ruby-string">&quot;blacklabVersion&quot;</span>] <span class="ruby-operator">:</span> <span class="ruby-string">&quot;1.5.0&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.3.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

